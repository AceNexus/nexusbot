<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全能深度分析大師 (NexusBot)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .text-up { color: #dc2626; }
        .text-down { color: #16a34a; }
        .bg-up-light { background-color: rgba(220, 38, 38, 0.05); }
        .bg-down-light { background-color: rgba(22, 163, 74, 0.05); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">
<div id="root"></div>

<script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
        const [symbol, setSymbol] = useState("2330");
        const [data, setData] = useState(null);
        const [loading, setLoading] = useState(false);

        const fetchData = async () => {
            setLoading(true);
            try {
                const res = await fetch(`/api/stock/${symbol}/institutional-investors?days=10`);
                if (res.ok) {
                    const result = await res.json();
                    setData(result);
                }
            } catch (err) {
                console.error(err);
            } finally {
                setLoading(false);
            }
        };

        useEffect(() => {
            fetchData();
        }, []);

        return (
            <div className="max-w-5xl mx-auto space-y-6">
                <header className="flex justify-between items-center">
                    <h1 className="text-3xl font-black text-slate-800">全能深度分析大師</h1>
                    <div className="flex gap-2">
                        <input
                            type="text"
                            value={symbol}
                            onChange={e => setSymbol(e.target.value)}
                            className="px-4 py-2 rounded-xl border border-slate-200 outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="輸入股票代號"
                        />
                        <button
                            onClick={fetchData}
                            className="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-indigo-700 transition-all"
                        >
                            深度分析
                        </button>
                    </div>
                </header>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div className="md:col-span-2 glass p-8 rounded-[32px] shadow-xl">
                        <h2 className="text-xl font-bold mb-4">法人籌碼趨勢 (近 10 日)</h2>
                        {loading ? (
                            <div className="h-64 flex items-center justify-center">載入中...</div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full text-left">
                                    <thead>
                                        <tr className="text-slate-400 text-sm">
                                            <th className="pb-4">日期</th>
                                            <th className="pb-4 text-right">外資</th>
                                            <th className="pb-4 text-right">投信</th>
                                            <th className="pb-4 text-right">自營</th>
                                            <th className="pb-4 text-right">合計</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {data && data.map((day, i) => (
                                            <tr key={i} className="text-sm">
                                                <td className="py-3 font-mono">{day.date}</td>
                                                <td className={`py-3 text-right font-mono ${day.foreignInvestorBuySell > 0 ? 'text-up' : 'text-down'}`}>
                                                    {day.foreignInvestorBuySell?.toLocaleString()}
                                                </td>
                                                <td className={`py-3 text-right font-mono ${day.investmentTrustBuySell > 0 ? 'text-up' : 'text-down'}`}>
                                                    {day.investmentTrustBuySell?.toLocaleString()}
                                                </td>
                                                <td className={`py-3 text-right font-mono ${day.dealerBuySell > 0 ? 'text-up' : 'text-down'}`}>
                                                    {day.dealerBuySell?.toLocaleString()}
                                                </td>
                                                <td className={`py-3 text-right font-mono font-bold ${day.totalBuySell > 0 ? 'text-up' : 'text-down'}`}>
                                                    {day.totalBuySell?.toLocaleString()}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>

                    <div className="space-y-6">
                        <div className="bg-gradient-to-br from-indigo-600 to-purple-700 p-8 rounded-[32px] text-white shadow-xl">
                            <h3 className="text-lg font-bold mb-2">AI 操盤手建議</h3>
                            <p className="text-indigo-100 text-sm leading-relaxed">
                                目前該個股法人買盤穩定，外資連續三日買超。建議觀察 5 日線支撐，若未跌破可持續持股。
                            </p>
                            <div className="mt-4 pt-4 border-t border-indigo-400/30">
                                <div className="text-xs text-indigo-200">AI 信心指數</div>
                                <div className="text-2xl font-black mt-1">85%</div>
                            </div>
                        </div>

                        <div className="glass p-8 rounded-[32px] shadow-lg">
                            <h3 className="font-bold mb-4">基本面評分</h3>
                            <div className="space-y-4">
                                {[
                                    { label: "營收成長", score: 90 },
                                    { label: "獲利能力", score: 82 },
                                    { label: "資產品質", score: 75 }
                                ].map((item, i) => (
                                    <div key={i}>
                                        <div className="flex justify-between text-xs mb-1">
                                            <span>{item.label}</span>
                                            <span className="font-bold">{item.score}</span>
                                        </div>
                                        <div className="h-1.5 bg-slate-100 rounded-full overflow-hidden">
                                            <div className="h-full bg-indigo-500 rounded-full" style={{ width: `${item.score}%` }}></div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
